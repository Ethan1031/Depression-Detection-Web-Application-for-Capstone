<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EEG Depression Detection System</title>
  </head>
  <body>
    <header>
      <h1>EEG Depression Detection System</h1>
      <h2>Upload EEG Data for Analysis</h2>
    </header>

    <main>
      <section>
        <h3>Instructions:</h3>
        <ol>
          <li>Please ensure your EEG file is in .edf format</li>
          <li>The file should contain the required EEG channels</li>
          <li>Each recording should be at least 10 seconds long</li>
          <li>Wait for the analysis to complete after uploading</li>
        </ol>
      </section>

      <section>
        <form id="uploadForm">
          <fieldset>
            <legend>Upload EEG File</legend>
            <p>
              <label for="eegFile">Select EEG File (.edf):</label><br />
              <input
                type="file"
                id="eegFile"
                name="file"
                accept=".edf"
                required
              />
            </p>
            <p>
              <button type="submit">Analyze EEG</button>
            </p>
          </fieldset>
        </form>
      </section>

      <section>
        <div id="loadingMessage" style="display: none">
          <p>
            <strong
              >Processing... Please wait while we analyze your EEG data.</strong
            >
          </p>
        </div>

        <div id="resultSection" style="display: none">
          <h3>Analysis Results:</h3>
          <p><strong>Diagnosis: </strong><span id="predictionResult"></span></p>
          <p>
            <strong>Confidence: </strong><span id="confidenceResult"></span>%
          </p>
          <p>
            <strong>Segments Analyzed: </strong
            ><span id="segmentsResult"></span>
          </p>
        </div>

        <div id="errorMessage" style="display: none">
          <p style="color: red">
            <strong>Error: </strong><span id="errorText"></span>
          </p>
        </div>
      </section>
    </main>

    <footer>
      <hr />
      <p>
        <small
          >Note: This system is intended for research purposes only and should
          not be used as a sole diagnostic tool.</small
        >
      </p>
    </footer>

    <script>
      document
        .getElementById("uploadForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          // Hide previous results and show loading
          document.getElementById("resultSection").style.display = "none";
          document.getElementById("errorMessage").style.display = "none";
          document.getElementById("loadingMessage").style.display = "block";

          const formData = new FormData();
          const fileField = document.getElementById("eegFile");
          formData.append("file", fileField.files[0]);

          try {
            const response = await fetch("/predict", {
              method: "POST",
              body: formData,
            });

            const result = await response.json();

            // Hide loading message
            document.getElementById("loadingMessage").style.display = "none";

            if (result.error) {
              // Show error message
              document.getElementById("errorText").textContent = result.error;
              document.getElementById("errorMessage").style.display = "block";
            } else {
              // Show results
              document.getElementById("predictionResult").textContent =
                result.prediction;
              document.getElementById("confidenceResult").textContent =
                result.confidence;
              document.getElementById("segmentsResult").textContent =
                result.segments_analyzed;
              document.getElementById("resultSection").style.display = "block";
            }
          } catch (error) {
            // Hide loading and show error
            document.getElementById("loadingMessage").style.display = "none";
            document.getElementById("errorText").textContent =
              "An error occurred during file upload. Please try again.";
            document.getElementById("errorMessage").style.display = "block";
          }
        });
    </script>
  </body>
</html>
